<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Travel Photographer - Professional Photography Assistant</title>
    <meta name="description" content="AI-powered photography assistant providing real-time camera settings, composition tips, and professional analysis for travel photographers.">
    <meta name="keywords" content="photography, AI, camera, travel, composition, analysis, professional">
    <meta name="author" content="AI Travel Photographer">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì∏</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/exif-js@2.3.0/exif.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#000;color:#fff;overflow-x:hidden}.container{min-height:100vh;display:flex;flex-direction:column}.header{background:#000;padding:20px;border-bottom:1px solid #333;display:flex;justify-content:space-between;align-items:center}.header h1{margin:0;font-size:24px;font-weight:700}.header-buttons{display:flex;gap:12px}.header-btn{width:40px;height:40px;border-radius:20px;background:rgba(255,255,255,0.1);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease}.header-btn:hover{background:rgba(255,255,255,0.2)}.main-content{flex:1;padding:20px}.camera-section{background:#111;border-radius:16px;padding:20px;margin-bottom:20px;position:relative;overflow:hidden}.camera-container{position:relative;width:100%;height:400px;background:#000;border-radius:12px;overflow:hidden}.video{width:100%;height:100%;object-fit:cover;border-radius:12px}.camera-placeholder{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.8)}.camera-text{font-size:24px;font-weight:600;margin-bottom:8px}.camera-subtext{font-size:16px;opacity:0.7;text-align:center}.composition-overlay{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.vertical-line{position:absolute;top:0;bottom:0;width:1px;background:rgba(255,255,255,0.3)}.horizontal-line{position:absolute;left:0;right:0;height:1px;background:rgba(255,255,255,0.3)}.camera-status{position:absolute;top:20px;right:20px;background:rgba(0,0,0,0.8);padding:8px 12px;border-radius:20px;display:flex;align-items:center;gap:8px}.status-indicator{width:8px;height:8px;background:#4CAF50;border-radius:50%}.status-text{font-size:12px;font-weight:600}.camera-controls{display:flex;justify-content:center;align-items:center;gap:20px;margin-top:20px}.capture-button{width:80px;height:80px;border-radius:50%;background:#fff;border:4px solid #333;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;position:relative}.capture-button:hover{transform:scale(1.05)}.capture-button-inner{width:60px;height:60px;border-radius:50%;background:#333}.control-button{width:50px;height:50px;border-radius:25px;background:rgba(255,255,255,0.1);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease}.control-button:hover{background:rgba(255,255,255,0.2)}.ai-button{background:#007AFF;color:#fff;border:none;padding:12px 20px;border-radius:25px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600;transition:all 0.3s ease}.ai-button:hover{background:#0056CC}.upload-placeholder{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.8)}.upload-button{background:#4CAF50;color:#fff;border:none;padding:12px 20px;border-radius:25px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600;transition:all 0.3s ease}.upload-button:hover{background:#45A049}.uploaded-image-container{position:relative;width:100%;height:100%}.uploaded-image{width:100%;height:100%;object-fit:cover;border-radius:12px}.clear-image-button{position:absolute;top:10px;right:10px;width:30px;height:30px;border-radius:15px;background:rgba(255,0,0,0.8);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center}.hidden-file-input{display:none}.analysis-panel{background:#111;border-radius:16px;padding:20px;margin-top:20px}.analysis-title{font-size:20px;font-weight:700;margin-bottom:16px;color:#007AFF}.analysis-section{margin-bottom:20px}.section-title{font-size:16px;font-weight:600;margin-bottom:8px;color:#4CAF50}.section-content{font-size:14px;line-height:1.5;opacity:0.9}.analysis-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px}.analysis-item{background:rgba(255,255,255,0.05);padding:12px;border-radius:8px}.analysis-label{font-size:12px;opacity:0.7;margin-bottom:4px}.analysis-value{font-size:14px;font-weight:600}.tips-list{list-style:none;padding:0}.tips-list li{padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1)}.tips-list li:last-child{border-bottom:none}.tips-list li:before{content:"üí°";margin-right:8px}.overall-score{text-align:center;padding:20px;background:rgba(0,122,255,0.1);border-radius:12px;margin-top:20px}.score-number{font-size:48px;font-weight:700;color:#007AFF;margin-bottom:8px}.score-label{font-size:16px;opacity:0.8}.debug-info{background:rgba(0,0,0,0.8);padding:10px;margin:10px;border-radius:8px;font-family:monospace;font-size:12px;color:#00FF00}.instructions-container{background:rgba(0,122,255,0.1);padding:15px;margin:10px;border-radius:8px;border:1px solid #007AFF}.instructions-text{color:#007AFF;font-size:14px;font-weight:600;text-align:center}@media (max-width:768px){.header{padding:15px}.header h1{font-size:20px}.camera-container{height:300px}.capture-button{width:70px;height:70px}.capture-button-inner{width:50px;height:50px}.analysis-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì∏ AI Travel Photographer</h1>
            <div class="header-buttons">
                <button class="header-btn" id="cameraModeBtn" title="Camera Mode">üì∑</button>
                <button class="header-btn" id="uploadModeBtn" title="Upload Mode">üìÅ</button>
                <button class="header-btn" id="compositionBtn" title="Toggle Composition Overlay">‚äû</button>
            </div>
        </div>

        <div class="main-content">
            <!-- Debug Info -->
            <div id="debugInfo" class="debug-info">
                <div style="color: #00FF00; font-family: monospace; font-size: 12px;">
                    Debug: Camera Active: NO<br>
                    Analysis Mode: camera<br>
                    Uploaded Image: NO
                </div>
            </div>

            <!-- Instructions -->
            <div class="instructions-container">
                <div class="instructions-text">
                    üì∏ Step 1: Click "Start Camera" ‚Üí Step 2: Allow permissions ‚Üí Step 3: Click capture button
                </div>
            </div>

            <!-- Camera/Upload Section -->
            <div class="camera-section">
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
                
                <div class="camera-container">
                    <video id="videoElement" class="video" autoplay playsinline style="display: none;"></video>
                    
                    <div id="cameraPlaceholder" class="camera-placeholder">
                        <div style="font-size: 80px; margin-bottom: 16px;">üì∑</div>
                        <div class="camera-text">Camera Ready</div>
                        <div class="camera-subtext">Click "Start Camera" to begin</div>
                    </div>
                    
                    <div id="uploadPlaceholder" class="upload-placeholder" style="display: none;">
                        <div style="font-size: 80px; margin-bottom: 16px;">üìÅ</div>
                        <div class="camera-text">Upload Image</div>
                        <div class="camera-subtext">Click "Choose File" to upload an image for analysis</div>
                        <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                            üìÅ Choose File
                        </button>
                    </div>
                    
                    <div id="uploadedImageContainer" class="uploaded-image-container" style="display: none;">
                        <img id="uploadedImage" class="uploaded-image" alt="Uploaded for analysis">
                        <button class="clear-image-button" onclick="clearUploadedImage()">‚úï</button>
                    </div>
                    
                    <div id="compositionOverlay" class="composition-overlay" style="display: none;">
                        <div class="vertical-line" style="left: 33.33%;"></div>
                        <div class="vertical-line" style="left: 66.66%;"></div>
                        <div class="horizontal-line" style="top: 33.33%;"></div>
                        <div class="horizontal-line" style="top: 66.66%;"></div>
                    </div>
                    
                    <div id="cameraStatus" class="camera-status" style="display: none;">
                        <div class="status-indicator"></div>
                        <div class="status-text">Camera Active</div>
                    </div>
                </div>
                
                <div class="camera-controls">
                    <button id="startCameraBtn" class="control-button">üì∑ Start Camera</button>
                    <button id="captureBtn" class="capture-button">
                        <div class="capture-button-inner"></div>
                    </button>
                    <button id="stopCameraBtn" class="control-button">‚èπÔ∏è Stop</button>
                    <button id="analyzeBtn" class="ai-button">‚ú® Analyze Scene</button>
                    <button id="analyzeLastPhotoBtn" class="ai-button" style="background: #4CAF50; display: none;">‚ú® Analyze Last Photo</button>
                </div>
            </div>

            <!-- Analysis Panel -->
            <div id="analysisPanel" class="analysis-panel" style="display: none;">
                <div class="analysis-title">üìä AI Photography Analysis</div>
                <div id="analysisContent"></div>
            </div>
        </div>
    </div>

    <script>
        let cameraActive = false;
        let currentMode = 'camera';
        let uploadedImageData = null;
        let capturedPhotoData = null;
        let capturedPhotoUrl = null;

        const videoElement = document.getElementById('videoElement');
        const cameraPlaceholder = document.getElementById('cameraPlaceholder');
        const uploadPlaceholder = document.getElementById('uploadPlaceholder');
        const uploadedImageContainer = document.getElementById('uploadedImageContainer');
        const compositionOverlay = document.getElementById('compositionOverlay');
        const cameraStatus = document.getElementById('cameraStatus');
        const analysisPanel = document.getElementById('analysisPanel');
        const analysisContent = document.getElementById('analysisContent');
        const analyzeLastPhotoBtn = document.getElementById('analyzeLastPhotoBtn');

        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo) {
                debugInfo.innerHTML = `
                    <div style="color: #00FF00; font-family: monospace; font-size: 12px;">
                        Debug: Camera Active: ${cameraActive ? 'YES' : 'NO'}<br>
                        Analysis Mode: ${currentMode}<br>
                        Uploaded Image: ${uploadedImageData ? 'YES' : 'NO'}<br>
                        Captured Photo: ${capturedPhotoData ? 'YES' : 'NO'}
                    </div>
                `;
            }
        }

        function setMode(mode) {
            currentMode = mode;
            updateDebugInfo();
            
            if (mode === 'camera') {
                cameraPlaceholder.style.display = 'flex';
                uploadPlaceholder.style.display = 'none';
                uploadedImageContainer.style.display = 'none';
                document.getElementById('startCameraBtn').style.display = 'flex';
                document.getElementById('captureBtn').style.display = 'flex';
                document.getElementById('stopCameraBtn').style.display = 'flex';
                document.getElementById('analyzeBtn').textContent = '‚ú® Analyze Scene';
            } else {
                cameraPlaceholder.style.display = 'none';
                uploadPlaceholder.style.display = 'flex';
                uploadedImageContainer.style.display = 'none';
                document.getElementById('startCameraBtn').style.display = 'none';
                document.getElementById('captureBtn').style.display = 'none';
                document.getElementById('stopCameraBtn').style.display = 'none';
                document.getElementById('analyzeBtn').textContent = '‚ú® Analyze Image';
            }
        }

        async function startCamera() {
            try {
                console.log('üé• Starting camera...');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'environment'
                    } 
                });
                
                videoElement.srcObject = stream;
                videoElement.style.display = 'block';
                cameraPlaceholder.style.display = 'none';
                cameraStatus.style.display = 'flex';
                cameraActive = true;
                
                console.log('‚úÖ Camera started successfully');
                updateDebugInfo();
                
            } catch (error) {
                console.error('‚ùå Camera error:', error);
                alert('Camera access denied. Please allow camera permissions and try again.');
            }
        }

        function stopCamera() {
            if (videoElement.srcObject) {
                videoElement.srcObject.getTracks().forEach(track => track.stop());
                videoElement.srcObject = null;
            }
            videoElement.style.display = 'none';
            cameraPlaceholder.style.display = 'flex';
            cameraStatus.style.display = 'none';
            cameraActive = false;
            updateDebugInfo();
        }

        function capturePhoto() {
            if (!cameraActive || !videoElement.srcObject) {
                alert('Please start the camera first!');
                return;
            }

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            canvas.width = videoElement.videoWidth;
            canvas.height = videoElement.videoHeight;
            context.drawImage(videoElement, 0, 0);
            
            canvas.toBlob((blob) => {
                if (blob) {
                    capturedPhotoData = blob;
                    capturedPhotoUrl = URL.createObjectURL(blob);
                    
                    const a = document.createElement('a');
                    a.href = capturedPhotoUrl;
                    a.download = `ai-photo-${Date.now()}.jpg`;
                    a.click();
                    
                    analyzeLastPhotoBtn.style.display = 'flex';
                    updateDebugInfo();
                    
                    console.log('üì∏ Photo captured and saved!');
                    alert('Photo captured! Click "Analyze Last Photo" for detailed analysis.');
                }
            }, 'image/jpeg', 0.9);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImageData = e.target.result;
                    document.getElementById('uploadedImage').src = uploadedImageData;
                    uploadPlaceholder.style.display = 'none';
                    uploadedImageContainer.style.display = 'block';
                    updateDebugInfo();
                };
                reader.readAsDataURL(file);
            }
        }

        function clearUploadedImage() {
            uploadedImageData = null;
            uploadPlaceholder.style.display = 'flex';
            uploadedImageContainer.style.display = 'none';
            updateDebugInfo();
        }

        function toggleComposition() {
            const isVisible = compositionOverlay.style.display !== 'none';
            compositionOverlay.style.display = isVisible ? 'none' : 'block';
        }

        async function analyzeImageProperties(imageBlob) {
            return new Promise((resolve) => {
                const img = new Image();
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);
                    
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const data = imageData.data;
                    
                    let totalBrightness = 0;
                    let totalRed = 0, totalGreen = 0, totalBlue = 0;
                    
                    for (let i = 0; i < data.length; i += 4) {
                        const r = data[i];
                        const g = data[i + 1];
                        const b = data[i + 2];
                        
                        const brightness = (r + g + b) / 3;
                        totalBrightness += brightness;
                        totalRed += r;
                        totalGreen += g;
                        totalBlue += b;
                    }
                    
                    const pixelCount = data.length / 4;
                    const avgBrightness = totalBrightness / pixelCount;
                    const avgRed = totalRed / pixelCount;
                    const avgGreen = totalGreen / pixelCount;
                    const avgBlue = totalBlue / pixelCount;
                    
                    let contrastSum = 0;
                    for (let i = 0; i < data.length; i += 4) {
                        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
                        contrastSum += Math.abs(brightness - avgBrightness);
                    }
                    const contrast = contrastSum / pixelCount;
                    
                    let lightingCondition = 'Balanced lighting';
                    let lightingQuality = 'Good';
                    let colorTemperature = 'Daylight (5500K)';
                    
                    if (avgBrightness < 100) {
                        lightingCondition = 'Low light conditions';
                        lightingQuality = 'Needs improvement';
                        colorTemperature = 'Warm (3000K)';
                    } else if (avgBrightness > 200) {
                        lightingCondition = 'Bright/overexposed';
                        lightingQuality = 'Too bright';
                        colorTemperature = 'Cool (6500K)';
                    }
                    
                    const aspectRatio = img.width / img.height;
                    let compositionScore = 70;
                    let hasDepth = true;
                    
                    if (aspectRatio > 1.5 || aspectRatio < 0.7) {
                        compositionScore -= 10;
                    }
                    
                    if (contrast < 30) {
                        compositionScore -= 15;
                        hasDepth = false;
                    }
                    
                    let detectedGenre = 'General Photography';
                    if (avgBrightness > 180 && contrast > 50) {
                        detectedGenre = 'Portrait Photography';
                    } else if (aspectRatio > 1.3) {
                        detectedGenre = 'Landscape Photography';
                    } else if (avgBrightness < 120) {
                        detectedGenre = 'Low Light Photography';
                    }
                    
                    const recommendations = [];
                    const specificTips = [];
                    
                    if (avgBrightness < 100) {
                        recommendations.push('Increase exposure');
                        specificTips.push('Try increasing camera exposure or using flash');
                    }
                    if (contrast < 30) {
                        recommendations.push('Improve contrast');
                        specificTips.push('Adjust lighting or post-processing contrast');
                    }
                    if (compositionScore < 70) {
                        recommendations.push('Improve composition');
                        specificTips.push('Use rule of thirds, try different angles');
                    }
                    if (recommendations.length === 0) {
                        recommendations.push('Good technical quality');
                        specificTips.push('Try different compositions for variety');
                    }
                    
                    const overallScore = Math.round(
                        compositionScore + 
                        (lightingQuality === 'Good' ? 20 : 10) + 
                        (contrast > 40 ? 10 : 0) + 
                        (avgBrightness > 100 && avgBrightness < 200 ? 10 : 0)
                    );
                    
                    let overallQuality = 'Good';
                    if (overallScore >= 85) overallQuality = 'Excellent';
                    else if (overallScore >= 70) overallQuality = 'Good';
                    else if (overallScore >= 55) overallQuality = 'Fair';
                    else overallQuality = 'Needs Improvement';
                    
                    const strengths = [];
                    const improvements = [];
                    
                    if (overallScore >= 80) strengths.push('Excellent technical quality');
                    if (contrast > 40) strengths.push('Good contrast');
                    if (avgBrightness > 100 && avgBrightness < 200) strengths.push('Proper exposure');
                    if (compositionScore > 75) strengths.push('Good composition');
                    
                    if (overallScore < 70) improvements.push('Improve overall quality');
                    if (contrast < 30) improvements.push('Increase contrast');
                    if (avgBrightness < 100) improvements.push('Better lighting needed');
                    if (compositionScore < 70) improvements.push('Work on composition');
                    
                    resolve({
                        lightingCondition,
                        lightingQuality,
                        colorTemperature,
                        brightness: Math.round(avgBrightness),
                        contrast: Math.round(contrast),
                        compositionScore,
                        hasDepth,
                        detectedGenre,
                        recommendations,
                        specificTips,
                        overallScore,
                        overallQuality,
                        strengths,
                        improvements,
                    });
                };
                
                img.src = URL.createObjectURL(imageBlob);
            });
        }

        async function extractImageMetadata(file) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const basicMetadata = {
                        resolution: `${img.naturalWidth}x${img.naturalHeight}`,
                        aspectRatio: (img.naturalWidth / img.naturalHeight).toFixed(2),
                        megapixels: ((img.naturalWidth * img.naturalHeight) / 1000000).toFixed(1),
                        fileSize: file.size ? `${(file.size / 1024).toFixed(1)} KB` : 'Unknown',
                        fileType: file.type || 'image/jpeg',
                        fileName: file.name || 'captured-photo.jpg',
                        lastModified: file.lastModified ? new Date(file.lastModified).toLocaleString() : new Date().toLocaleString(),
                    };

                    EXIF.getData(img, function() {
                        const exifData = {
                            aperture: EXIF.getTag(this, 'FNumber') ? `f/${EXIF.getTag(this, 'FNumber')}` : 'Not available',
                            shutterSpeed: EXIF.getTag(this, 'ExposureTime') ? `1/${Math.round(1/EXIF.getTag(this, 'ExposureTime'))}s` : 'Not available',
                            iso: EXIF.getTag(this, 'ISOSpeedRatings') || 'Not available',
                            focalLength: EXIF.getTag(this, 'FocalLength') ? `${EXIF.getTag(this, 'FocalLength')}mm` : 'Not available',
                            exposureCompensation: EXIF.getTag(this, 'ExposureBiasValue') ? `${EXIF.getTag(this, 'ExposureBiasValue')} EV` : 'Not available',
                            whiteBalance: EXIF.getTag(this, 'WhiteBalance') === 1 ? 'Auto' : 'Manual',
                            meteringMode: EXIF.getTag(this, 'MeteringMode') ? EXIF.getTag(this, 'MeteringMode') : 'Not available',
                            focusMode: EXIF.getTag(this, 'FocusMode') ? EXIF.getTag(this, 'FocusMode') : 'Not available',
                            cameraMake: EXIF.getTag(this, 'Make') || 'Web Camera',
                            cameraModel: EXIF.getTag(this, 'Model') || 'Browser Camera',
                            dateTaken: EXIF.getTag(this, 'DateTime') || new Date().toISOString(),
                            flash: EXIF.getTag(this, 'Flash') ? 'Used' : 'Not used',
                            lensModel: EXIF.getTag(this, 'LensModel') || 'Not available',
                        };

                        resolve({ ...basicMetadata, ...exifData });
                    });
                };
                img.src = URL.createObjectURL(file);
            });
        }

        async function analyzeCapturedPhoto() {
            if (!capturedPhotoData) {
                alert('No captured photo available. Please capture a photo first.');
                return;
            }

            try {
                const file = new File([capturedPhotoData], 'captured-photo.jpg', { type: 'image/jpeg' });
                const metadata = await extractImageMetadata(file);
                const imageAnalysis = await analyzeImageProperties(capturedPhotoData);
                
                const analysis = {
                    technical: {
                        resolution: metadata.resolution,
                        aspectRatio: metadata.aspectRatio,
                        megapixels: metadata.megapixels,
                        fileSize: metadata.fileSize,
                        fileType: metadata.fileType,
                        fileName: metadata.fileName,
                        lastModified: metadata.lastModified,
                        aperture: metadata.aperture,
                        shutterSpeed: metadata.shutterSpeed,
                        iso: metadata.iso,
                        focalLength: metadata.focalLength,
                        exposureCompensation: metadata.exposureCompensation,
                        whiteBalance: metadata.whiteBalance,
                        meteringMode: metadata.meteringMode,
                        focusMode: metadata.focusMode,
                        cameraMake: metadata.cameraMake,
                        cameraModel: metadata.cameraModel,
                        dateTaken: metadata.dateTaken,
                        flash: metadata.flash,
                        lensModel: metadata.lensModel,
                    },
                    lighting: {
                        condition: imageAnalysis.lightingCondition,
                        quality: imageAnalysis.lightingQuality,
                        colorTemp: imageAnalysis.colorTemperature,
                        brightness: imageAnalysis.brightness,
                        contrast: imageAnalysis.contrast,
                    },
                    composition: {
                        ruleOfThirds: imageAnalysis.compositionScore > 70 ? 'Good composition' : 'Consider rule of thirds',
                        depth: imageAnalysis.hasDepth ? 'Good depth perception' : 'Try adding depth',
                        framing: imageAnalysis.compositionScore > 75 ? 'Well-framed' : 'Consider better framing',
                        balance: imageAnalysis.compositionScore > 70 ? 'Good balance' : 'Try improving balance',
                    },
                    settings: {
                        current: `Resolution: ${metadata.resolution}, File Size: ${metadata.fileSize}, Quality: ${imageAnalysis.overallQuality}`,
                        recommended: imageAnalysis.recommendations.join(', '),
                        reasoning: `Based on analysis of ${metadata.resolution} image with ${imageAnalysis.overallQuality} quality`,
                    },
                    tips: imageAnalysis.specificTips,
                    overall: {
                        score: imageAnalysis.overallScore,
                        genre: imageAnalysis.detectedGenre,
                        strengths: imageAnalysis.strengths,
                        improvements: imageAnalysis.improvements,
                        timestamp: new Date().toISOString(),
                    },
                };
                
                updateAnalysisPanel(analysis);
                alert(`Analysis complete! Score: ${imageAnalysis.overallScore}/100`);
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('Failed to analyze photo. Please try again.');
            }
        }

        async function analyzeUploadedImage() {
            if (!uploadedImageData) {
                alert('Please upload an image first.');
                return;
            }

            try {
                const fileInput = document.getElementById('fileInput');
                const file = fileInput.files[0];
                if (!file) return;

                const metadata = await extractImageMetadata(file);
                const imageAnalysis = await analyzeImageProperties(file);
                
                const analysis = {
                    technical: {
                        resolution: metadata.resolution,
                        aspectRatio: metadata.aspectRatio,
                        megapixels: metadata.megapixels,
                        fileSize: metadata.fileSize,
                        fileType: metadata.fileType,
                        fileName: metadata.fileName,
                        lastModified: metadata.lastModified,
                        aperture: metadata.aperture,
                        shutterSpeed: metadata.shutterSpeed,
                        iso: metadata.iso,
                        focalLength: metadata.focalLength,
                        exposureCompensation: metadata.exposureCompensation,
                        whiteBalance: metadata.whiteBalance,
                        meteringMode: metadata.meteringMode,
                        focusMode: metadata.focusMode,
                        cameraMake: metadata.cameraMake,
                        cameraModel: metadata.cameraModel,
                        dateTaken: metadata.dateTaken,
                        flash: metadata.flash,
                        lensModel: metadata.lensModel,
                    },
                    lighting: {
                        condition: imageAnalysis.lightingCondition,
                        quality: imageAnalysis.lightingQuality,
                        colorTemp: imageAnalysis.colorTemperature,
                        brightness: imageAnalysis.brightness,
                        contrast: imageAnalysis.contrast,
                    },
                    composition: {
                        ruleOfThirds: imageAnalysis.compositionScore > 70 ? 'Good composition' : 'Consider rule of thirds',
                        depth: imageAnalysis.hasDepth ? 'Good depth perception' : 'Try adding depth',
                        framing: imageAnalysis.compositionScore > 75 ? 'Well-framed' : 'Consider better framing',
                        balance: imageAnalysis.compositionScore > 70 ? 'Good balance' : 'Try improving balance',
                    },
                    settings: {
                        current: `Resolution: ${metadata.resolution}, File Size: ${metadata.fileSize}, Quality: ${imageAnalysis.overallQuality}`,
                        recommended: imageAnalysis.recommendations.join(', '),
                        reasoning: `Based on analysis of ${metadata.resolution} image with ${imageAnalysis.overallQuality} quality`,
                    },
                    tips: imageAnalysis.specificTips,
                    overall: {
                        score: imageAnalysis.overallScore,
                        genre: imageAnalysis.detectedGenre,
                        strengths: imageAnalysis.strengths,
                        improvements: imageAnalysis.improvements,
                        timestamp: new Date().toISOString(),
                    },
                };
                
                updateAnalysisPanel(analysis);
                alert(`Analysis complete! Score: ${imageAnalysis.overallScore}/100`);
                
            } catch (error) {
                console.error('Analysis error:', error);
                alert('Failed to analyze image. Please try again.');
            }
        }

        function analyzeScene() {
            const mockAnalysis = {
                technical: {
                    resolution: '1280x720',
                    aspectRatio: '1.78',
                    megapixels: '0.9',
                    fileSize: 'Unknown',
                    fileType: 'Live Camera Feed',
                    fileName: 'Live Feed',
                    lastModified: new Date().toLocaleString(),
                    aperture: 'Not available',
                    shutterSpeed: 'Not available',
                    iso: 'Not available',
                    focalLength: 'Not available',
                    exposureCompensation: 'Not available',
                    whiteBalance: 'Auto',
                    meteringMode: 'Not available',
                    focusMode: 'Auto',
                    cameraMake: 'Web Camera',
                    cameraModel: 'Browser Camera',
                    dateTaken: new Date().toISOString(),
                    flash: 'Not used',
                    lensModel: 'Not available',
                },
                lighting: {
                    condition: 'Live scene analysis',
                    quality: 'Good',
                    colorTemp: 'Daylight (5500K)',
                    brightness: 'Balanced',
                    contrast: 'Good',
                },
                composition: {
                    ruleOfThirds: 'Consider applying rule of thirds for better composition',
                    depth: 'Good depth of field',
                    framing: 'Well-framed subject',
                    balance: 'Good balance',
                },
                settings: {
                    current: 'Live camera feed - 1280x720 resolution',
                    recommended: 'Consider adjusting exposure for optimal results',
                    reasoning: 'Based on live scene analysis',
                },
                tips: [
                    'Try different angles for more dynamic shots',
                    'Consider using composition overlays',
                    'Experiment with different lighting conditions',
                ],
                overall: {
                    score: 75,
                    genre: 'Live Photography',
                    strengths: ['Good technical quality', 'Clear image capture', 'Proper exposure'],
                    improvements: ['Try different compositions', 'Experiment with angles', 'Consider lighting variations'],
                    timestamp: new Date().toISOString(),
                },
            };
            
            updateAnalysisPanel(mockAnalysis);
            alert('Live scene analysis complete! Check the analysis panel below.');
        }

        function updateAnalysisPanel(analysis) {
            analysisContent.innerHTML = `
                <div class="overall-score">
                    <div class="score-number">${analysis.overall.score}</div>
                    <div class="score-label">Overall Score / 100</div>
                    <div style="margin-top: 8px; font-size: 14px; opacity: 0.8;">${analysis.overall.genre}</div>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-section">
                        <div class="section-title">üìä Technical Details</div>
                        <div class="analysis-item">
                            <div class="analysis-label">Resolution</div>
                            <div class="analysis-value">${analysis.technical.resolution}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Aspect Ratio</div>
                            <div class="analysis-value">${analysis.technical.aspectRatio}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Megapixels</div>
                            <div class="analysis-value">${analysis.technical.megapixels} MP</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">File Size</div>
                            <div class="analysis-value">${analysis.technical.fileSize}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Camera</div>
                            <div class="analysis-value">${analysis.technical.cameraMake} ${analysis.technical.cameraModel}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Aperture</div>
                            <div class="analysis-value">${analysis.technical.aperture}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Shutter Speed</div>
                            <div class="analysis-value">${analysis.technical.shutterSpeed}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">ISO</div>
                            <div class="analysis-value">${analysis.technical.iso}</div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">üí° Lighting Analysis</div>
                        <div class="analysis-item">
                            <div class="analysis-label">Condition</div>
                            <div class="analysis-value">${analysis.lighting.condition}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Quality</div>
                            <div class="analysis-value">${analysis.lighting.quality}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Color Temperature</div>
                            <div class="analysis-value">${analysis.lighting.colorTemp}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Brightness</div>
                            <div class="analysis-value">${analysis.lighting.brightness}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Contrast</div>
                            <div class="analysis-value">${analysis.lighting.contrast}</div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">üé® Composition</div>
                        <div class="analysis-item">
                            <div class="analysis-label">Rule of Thirds</div>
                            <div class="analysis-value">${analysis.composition.ruleOfThirds}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Depth</div>
                            <div class="analysis-value">${analysis.composition.depth}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Framing</div>
                            <div class="analysis-value">${analysis.composition.framing}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Balance</div>
                            <div class="analysis-value">${analysis.composition.balance}</div>
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="section-title">‚öôÔ∏è Settings</div>
                        <div class="analysis-item">
                            <div class="analysis-label">Current</div>
                            <div class="analysis-value">${analysis.settings.current}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Recommended</div>
                            <div class="analysis-value">${analysis.settings.recommended}</div>
                        </div>
                        <div class="analysis-item">
                            <div class="analysis-label">Reasoning</div>
                            <div class="analysis-value">${analysis.settings.reasoning}</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="section-title">üí° Photography Tips</div>
                    <ul class="tips-list">
                        ${analysis.tips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>

                <div class="analysis-section">
                    <div class="section-title">‚úÖ Strengths</div>
                    <ul class="tips-list">
                        ${analysis.overall.strengths.map(strength => `<li>${strength}</li>`).join('')}
                    </ul>
                </div>

                <div class="analysis-section">
                    <div class="section-title">üîß Improvements</div>
                    <ul class="tips-list">
                        ${analysis.overall.improvements.map(improvement => `<li>${improvement}</li>`).join('')}
                    </ul>
                </div>
            `;
            
            analysisPanel.style.display = 'block';
        }

        // Event Listeners
        document.getElementById('cameraModeBtn').addEventListener('click', () => setMode('camera'));
        document.getElementById('uploadModeBtn').addEventListener('click', () => setMode('upload'));
        document.getElementById('compositionBtn').addEventListener('click', toggleComposition);
        document.getElementById('startCameraBtn').addEventListener('click', startCamera);
        document.getElementById('stopCameraBtn').addEventListener('click', stopCamera);
        document.getElementById('captureBtn').addEventListener('click', capturePhoto);
        document.getElementById('analyzeBtn').addEventListener('click', () => {
            if (currentMode === 'camera') {
                analyzeScene();
            } else {
                analyzeUploadedImage();
            }
        });
        document.getElementById('analyzeLastPhotoBtn').addEventListener('click', analyzeCapturedPhoto);
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);

        // Initialize
        updateDebugInfo();
    </script>
</body>
</html>
